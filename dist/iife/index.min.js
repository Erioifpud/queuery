var Queuery=function(e){"use strict";function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}var r=(t(u.prototype,[{key:"task",value:function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.taskWithName.apply(this,[r,e].concat(r))}},{key:"taskWithName",value:function(e,t){for(var r=arguments.length,n=new Array(2<r?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this.queue.push({name:e,promiseWrapper:t,args:n.length?n:[],retries:0})}},{key:"remove",value:function(t){var e=this.queue.findIndex(function(e){return e.name===t});-1!==e&&(this.queue.splice(e,1),this.verbose&&console.log(t,"removed"))}},{key:"__checkNext",value:function(t){var e,r=this;if(this.queue.length){var n=this.queue.shift(),i=n.name,o=n.promiseWrapper,s=n.args,u=n.retries;u||this.running++,o.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e=s)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()).then(function(e){return r.running--,r.verbose&&console.log(i,"finished"),r.results.push({name:i,payload:e}),r.__checkNext(t),e}).catch(function(e){if(!(u<r.retries))return r.running--,r.verbose&&console.error(i,"failed"),r.results.push({name:i,payload:e}),r.__checkNext(t),e;r.queue.push(function(i){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?a(Object(o),!0).forEach(function(e){var t,r,n;t=i,n=o[r=e],r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(o,e))})}return i}({},n,{retries:u+1})),r.verbose&&console.log(i,"is retrying: ",u),r.__checkNext(t)})}else t()}},{key:"start",value:function(e){var o=this,s=this.queue.length<this.limit?this.queue.length:this.limit;s?new Promise(function(e){for(var t,r,n=(t=e,function(){s<=++r&&t()}),i=r=0;i<s;i++)o.__checkNext(n)}).then(function(){e(o.results)}):e(this.results)}}]),u);function u(e){!function(e){if(!(e instanceof u))throw new TypeError("Cannot call a class as a function")}(this);var t=e||{},r=t.limit,n=void 0===r?3:r,i=t.retries,o=void 0===i?3:i,s=t.verbose;this.queue=[],this.running=0,this.limit=n,this.retries=o,this.results=[],this.verbose=s}return e.default=r,e}({});
